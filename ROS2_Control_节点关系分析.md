# ROS2 Control èŠ‚ç‚¹å…³ç³»åˆ†æ

## ğŸ¯ èŠ‚ç‚¹æ¶æ„æ¦‚è§ˆ

ROS2 Controlé¡¹ç›®ä¸­çš„èŠ‚ç‚¹å…³ç³»ä½“ç°äº†**åˆ†å±‚ç®¡ç†**å’Œ**ç»Ÿä¸€è°ƒåº¦**çš„è®¾è®¡ç†å¿µã€‚æ•´ä¸ªç³»ç»Ÿé‡‡ç”¨**å•æ‰§è¡Œå™¨å¤šèŠ‚ç‚¹**çš„æ¶æ„ï¼Œé€šè¿‡Controller Managerä½œä¸ºæ ¸å¿ƒåè°ƒå™¨æ¥ç®¡ç†æ‰€æœ‰ç»„ä»¶ã€‚

## ğŸ“Š èŠ‚ç‚¹å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ROS2 Control èŠ‚ç‚¹æ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          ä¸»æ‰§è¡Œå™¨ (Main Executor)                          â”‚ â”‚
â”‚  â”‚                    MultiThreadedExecutor (å…±äº«æ‰§è¡Œå™¨)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                               â”‚
â”‚                                    â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        Controller Manager Node                             â”‚ â”‚
â”‚  â”‚                    (æ ¸å¿ƒç®¡ç†èŠ‚ç‚¹ - ç»§æ‰¿è‡ªrclcpp::Node)                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Service   â”‚  â”‚   Publisher â”‚  â”‚  Subscriber â”‚  â”‚   Parameter         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Services   â”‚  â”‚   Services  â”‚  â”‚   Services  â”‚  â”‚   Services          â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                               â”‚
â”‚                                    â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        åŠ¨æ€åŠ è½½çš„èŠ‚ç‚¹ (Dynamically Loaded)                  â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                    Controller Nodes                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚              (ç»§æ‰¿è‡ªrclcpp_lifecycle::LifecycleNode)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Controller1 â”‚  â”‚ Controller2 â”‚  â”‚ Controller3 â”‚  â”‚   ...           â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Node      â”‚  â”‚   Node      â”‚  â”‚   Node      â”‚  â”‚                 â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                    â”‚                                           â”‚ â”‚
â”‚  â”‚                                    â–¼                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                    Hardware Component Nodes                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                    (ç»§æ‰¿è‡ªrclcpp::Node)                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  System     â”‚  â”‚  Actuator   â”‚  â”‚   Sensor    â”‚  â”‚   Custom        â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Component   â”‚  â”‚ Component   â”‚  â”‚ Component   â”‚  â”‚   Component     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Node      â”‚  â”‚   Node      â”‚  â”‚   Node      â”‚  â”‚   Node          â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒèŠ‚ç‚¹åˆ†æ

### 1. **Controller Manager Node**

#### èŠ‚ç‚¹ç‰¹æ€§
- **ç±»å‹**: `rclcpp::Node` (ç»§æ‰¿)
- **åç§°**: `controller_manager` (é»˜è®¤)
- **å‘½åç©ºé—´**: å¯é…ç½®
- **ç”Ÿå‘½å‘¨æœŸ**: æ•´ä¸ªç³»ç»Ÿè¿è¡ŒæœŸé—´

#### æ ¸å¿ƒåŠŸèƒ½
```cpp
class ControllerManager : public rclcpp::Node {
public:
    // æ„é€ å‡½æ•° - åˆ›å»ºä¸»ç®¡ç†èŠ‚ç‚¹
    ControllerManager(
        std::shared_ptr<rclcpp::Executor> executor,
        const std::string& manager_node_name = "controller_manager",
        const std::string& node_namespace = "",
        const rclcpp::NodeOptions& options = get_cm_node_options());
    
    // æ ¸å¿ƒç®¡ç†åŠŸèƒ½
    controller_interface::ControllerInterfaceBaseSharedPtr load_controller(
        const std::string& controller_name, const std::string& controller_type);
    
    controller_interface::return_type configure_controller(const std::string& controller_name);
    controller_interface::return_type activate_controller(const std::string& controller_name);
    controller_interface::return_type deactivate_controller(const std::string& controller_name);
    
    // å®æ—¶æ§åˆ¶å¾ªç¯
    void read(const rclcpp::Time& time, const rclcpp::Duration& period);
    controller_interface::return_type update(const rclcpp::Time& time, const rclcpp::Duration& period);
    void write(const rclcpp::Time& time, const rclcpp::Duration& period);
};
```

#### æœåŠ¡æ¥å£
```cpp
// æ§åˆ¶å™¨ç®¡ç†æœåŠ¡
rclcpp::Service<controller_manager_msgs::srv::LoadController>::SharedPtr load_controller_service_;
rclcpp::Service<controller_manager_msgs::srv::ConfigureController>::SharedPtr configure_controller_service_;
rclcpp::Service<controller_manager_msgs::srv::ActivateController>::SharedPtr activate_controller_service_;
rclcpp::Service<controller_manager_msgs::srv::DeactivateController>::SharedPtr deactivate_controller_service_;
rclcpp::Service<controller_manager_msgs::srv::SwitchController>::SharedPtr switch_controller_service_;
rclcpp::Service<controller_manager_msgs::srv::UnloadController>::SharedPtr unload_controller_service_;

// ç¡¬ä»¶ç®¡ç†æœåŠ¡
rclcpp::Service<controller_manager_msgs::srv::ListHardwareComponents>::SharedPtr list_hardware_components_service_;
rclcpp::Service<controller_manager_msgs::srv::ListHardwareInterfaces>::SharedPtr list_hardware_interfaces_service_;
rclcpp::Service<controller_manager_msgs::srv::SetHardwareComponentState>::SharedPtr set_hardware_component_state_service_;

// æŸ¥è¯¢æœåŠ¡
rclcpp::Service<controller_manager_msgs::srv::ListControllers>::SharedPtr list_controllers_service_;
rclcpp::Service<controller_manager_msgs::srv::ListControllerTypes>::SharedPtr list_controller_types_service_;
```

#### å‘å¸ƒè€…/è®¢é˜…è€…
```cpp
// æ´»åŠ¨çŠ¶æ€å‘å¸ƒ
rclcpp::Publisher<controller_manager_msgs::msg::ControllerManagerActivity>::SharedPtr activity_publisher_;

// æœºå™¨äººæè¿°è®¢é˜…
rclcpp::Subscription<std_msgs::msg::String>::SharedPtr robot_description_subscription_;
```

### 2. **Controller Nodes**

#### èŠ‚ç‚¹ç‰¹æ€§
- **ç±»å‹**: `rclcpp_lifecycle::LifecycleNode` (ç»§æ‰¿)
- **åç§°**: åŠ¨æ€ç”Ÿæˆ (åŸºäºæ§åˆ¶å™¨åç§°)
- **ç”Ÿå‘½å‘¨æœŸ**: ä»åŠ è½½åˆ°å¸è½½

#### èŠ‚ç‚¹åˆ›å»ºè¿‡ç¨‹
```cpp
// åœ¨ControllerManagerä¸­åˆ›å»ºæ§åˆ¶å™¨èŠ‚ç‚¹
controller_interface::ControllerInterfaceBaseSharedPtr ControllerManager::load_controller(
    const std::string& controller_name, const std::string& controller_type) {
    
    // 1. åˆ›å»ºæ§åˆ¶å™¨å®ä¾‹
    auto controller = loader_->createUniqueInstance(controller_type);
    
    // 2. åˆå§‹åŒ–æ§åˆ¶å™¨ (åŒ…æ‹¬èŠ‚ç‚¹åˆ›å»º)
    controller->init(controller_name, urdf_, update_rate_, node_namespace_, node_options);
    
    // 3. å°†æ§åˆ¶å™¨èŠ‚ç‚¹æ·»åŠ åˆ°æ‰§è¡Œå™¨
    executor_->add_node(controller->get_node()->get_node_base_interface());
    
    return controller;
}
```

#### èŠ‚ç‚¹é…ç½®
```cpp
// æ§åˆ¶å™¨èŠ‚ç‚¹é€‰é¡¹é…ç½®
virtual rclcpp::NodeOptions define_custom_node_options() const {
    rclcpp::NodeOptions node_options;
    
    // æ”¯æŒæœªå£°æ˜å‚æ•° (ç”¨äºåŠ¨æ€å‚æ•°åŠ è½½)
    node_options.allow_undeclared_parameters(true);
    node_options.automatically_declare_parameters_from_overrides(true);
    
    // å¯ç”¨æ—¥å¿—æœåŠ¡
    node_options.enable_logger_service(true);
    
    return node_options;
}
```

### 3. **Hardware Component Nodes**

#### èŠ‚ç‚¹ç‰¹æ€§
- **ç±»å‹**: `rclcpp::Node` (ç»§æ‰¿)
- **åç§°**: åŠ¨æ€ç”Ÿæˆ (åŸºäºç¡¬ä»¶ç»„ä»¶åç§°)
- **ç”Ÿå‘½å‘¨æœŸ**: ä»ç¡¬ä»¶ç»„ä»¶åˆå§‹åŒ–åˆ°é”€æ¯

#### èŠ‚ç‚¹åˆ›å»ºè¿‡ç¨‹
```cpp
// åœ¨SystemInterfaceä¸­åˆ›å»ºç¡¬ä»¶ç»„ä»¶èŠ‚ç‚¹
CallbackReturn SystemInterface::init(const hardware_interface::HardwareComponentParams& params) {
    
    // 1. è·å–æ‰§è¡Œå™¨å¼•ç”¨
    if (auto locked_executor = params.executor.lock()) {
        
        // 2. ç”ŸæˆèŠ‚ç‚¹åç§°
        std::string node_name = params.hardware_info.name;
        std::transform(node_name.begin(), node_name.end(), node_name.begin(),
                      [](unsigned char c) { return std::tolower(c); });
        std::replace(node_name.begin(), node_name.end(), '/', '_');
        
        // 3. åˆ›å»ºç¡¬ä»¶ç»„ä»¶èŠ‚ç‚¹
        hardware_component_node_ = std::make_shared<rclcpp::Node>(node_name);
        
        // 4. å°†èŠ‚ç‚¹æ·»åŠ åˆ°æ‰§è¡Œå™¨
        locked_executor->add_node(hardware_component_node_->get_node_base_interface());
    }
    
    return CallbackReturn::SUCCESS;
}
```

## ğŸ”„ èŠ‚ç‚¹é—´é€šä¿¡å…³ç³»

### 1. **æœåŠ¡é€šä¿¡**

```
æœåŠ¡é€šä¿¡å…³ç³»å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¤–éƒ¨å®¢æˆ·ç«¯    â”‚    â”‚ Controller      â”‚    â”‚ Hardware        â”‚
â”‚   (CLI/GUI)     â”‚    â”‚ Manager Node    â”‚    â”‚ Component Nodes â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Service     â”‚â”‚    â”‚  â”‚ Service     â”‚â”‚    â”‚  â”‚ Service     â”‚â”‚
â”‚  â”‚ Client      â”‚â”‚    â”‚  â”‚ Server      â”‚â”‚    â”‚  â”‚ Server      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚  Service Calls        â”‚  Service Calls        â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load/Unload   â”‚    â”‚   Configure/    â”‚    â”‚   State/Command â”‚
â”‚   Controller    â”‚    â”‚   Activate/     â”‚    â”‚   Interface     â”‚
â”‚   Services      â”‚    â”‚   Switch        â”‚    â”‚   Services      â”‚
â”‚                 â”‚    â”‚   Services      â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **è¯é¢˜é€šä¿¡**

```
è¯é¢˜é€šä¿¡å…³ç³»å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller    â”‚    â”‚ Controller      â”‚    â”‚   External      â”‚
â”‚   Nodes         â”‚    â”‚ Manager Node    â”‚    â”‚   Subscribers   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Publisher   â”‚â”‚    â”‚  â”‚ Publisher   â”‚â”‚    â”‚  â”‚ Subscriber  â”‚â”‚
â”‚  â”‚ (Status)    â”‚â”‚    â”‚  â”‚ (Activity)  â”‚â”‚    â”‚  â”‚ (Monitoring)â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚  Status Topics        â”‚  Activity Topics      â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller    â”‚    â”‚   Controller    â”‚    â”‚   System        â”‚
â”‚   Status        â”‚    â”‚   Manager       â”‚    â”‚   Monitoring    â”‚
â”‚   Information   â”‚    â”‚   Activity      â”‚    â”‚   & Debugging   â”‚
â”‚                 â”‚    â”‚   Updates       â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. **å‚æ•°é€šä¿¡**

```
å‚æ•°é€šä¿¡å…³ç³»å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‚æ•°æ–‡ä»¶      â”‚    â”‚ Controller      â”‚    â”‚ Controller      â”‚
â”‚   (YAML)        â”‚    â”‚ Manager Node    â”‚    â”‚ Nodes           â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Parameter   â”‚â”‚    â”‚  â”‚ Parameter   â”‚â”‚    â”‚  â”‚ Parameter   â”‚â”‚
â”‚  â”‚ Server      â”‚â”‚    â”‚  â”‚ Server      â”‚â”‚    â”‚  â”‚ Client      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚  Parameter            â”‚  Parameter            â”‚
         â”‚  Loading              â”‚  Distribution         â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   System        â”‚    â”‚   Controller    â”‚    â”‚   Controller    â”‚
â”‚   Configuration â”‚    â”‚   Parameters    â”‚    â”‚   Runtime       â”‚
â”‚   Parameters    â”‚    â”‚   (Update Rate, â”‚    â”‚   Parameters    â”‚
â”‚                 â”‚    â”‚    Gains, etc.) â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ æ‰§è¡Œå™¨ç®¡ç†

### 1. **æ‰§è¡Œå™¨æ¶æ„**

```cpp
// ä¸»æ‰§è¡Œå™¨åˆ›å»º
std::shared_ptr<rclcpp::Executor> executor = 
    std::make_shared<rclcpp::executors::MultiThreadedExecutor>();

// å°†Controller Manageræ·»åŠ åˆ°æ‰§è¡Œå™¨
executor->add_node(cm);

// å°†åŠ¨æ€åŠ è½½çš„æ§åˆ¶å™¨èŠ‚ç‚¹æ·»åŠ åˆ°æ‰§è¡Œå™¨
executor_->add_node(controller->get_node()->get_node_base_interface());

// å°†ç¡¬ä»¶ç»„ä»¶èŠ‚ç‚¹æ·»åŠ åˆ°æ‰§è¡Œå™¨
locked_executor->add_node(hardware_component_node_->get_node_base_interface());
```

### 2. **æ‰§è¡Œå™¨çº¿ç¨‹æ¨¡å‹**

```
æ‰§è¡Œå™¨çº¿ç¨‹æ¨¡å‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MultiThreadedExecutor                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          ä¸»çº¿ç¨‹ (Main Thread)                              â”‚ â”‚
â”‚  â”‚                    - æ‰§è¡Œå™¨spin()                                          â”‚ â”‚
â”‚  â”‚                    - å¤„ç†æœåŠ¡è°ƒç”¨                                          â”‚ â”‚
â”‚  â”‚                    - ç®¡ç†èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                               â”‚
â”‚                                    â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          å·¥ä½œçº¿ç¨‹æ±  (Worker Threads)                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Worker    â”‚  â”‚   Worker    â”‚  â”‚   Worker    â”‚  â”‚   ...               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Thread 1   â”‚  â”‚  Thread 2   â”‚  â”‚  Thread 3   â”‚  â”‚                     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                               â”‚
â”‚                                    â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          å®æ—¶çº¿ç¨‹ (Real-time Thread)                        â”‚ â”‚
â”‚  â”‚                    - æ‰§è¡Œæ§åˆ¶å¾ªç¯ (read/update/write)                       â”‚ â”‚
â”‚  â”‚                    - å®æ—¶è°ƒåº¦ (SCHED_FIFO)                                  â”‚ â”‚
â”‚  â”‚                    - å›ºå®šé¢‘ç‡æ‰§è¡Œ                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. **å®æ—¶æ§åˆ¶å¾ªç¯**

```cpp
// å®æ—¶æ§åˆ¶å¾ªç¯å®ç°
std::thread cm_thread([cm, thread_priority, use_sim_time]() {
    // è®¾ç½®å®æ—¶è°ƒåº¦ç­–ç•¥
    realtime_tools::configure_sched_fifo(thread_priority);
    
    // è®¡ç®—æ§åˆ¶å‘¨æœŸ
    auto const period = std::chrono::nanoseconds(1'000'000'000 / cm->get_update_rate());
    
    while (rclcpp::ok()) {
        auto const current_time = cm->get_trigger_clock()->now();
        auto const measured_period = current_time - previous_time;
        
        // æ‰§è¡Œæ§åˆ¶å¾ªç¯
        cm->read(current_time, measured_period);
        cm->update(current_time, measured_period);
        cm->write(current_time, measured_period);
        
        // ç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸ
        std::this_thread::sleep_until(next_iteration_time);
    }
});
```

## ğŸ”— èŠ‚ç‚¹ä¾èµ–å…³ç³»

### 1. **å¯åŠ¨é¡ºåºä¾èµ–**

```
èŠ‚ç‚¹å¯åŠ¨é¡ºåº:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. ä¸»æ‰§è¡Œå™¨   â”‚ -> â”‚ 2. Controller   â”‚ -> â”‚ 3. Hardware    â”‚ -> â”‚ 4. Controller   â”‚
â”‚   å¯åŠ¨          â”‚    â”‚   Manager       â”‚    â”‚   Components    â”‚    â”‚   Nodes         â”‚
â”‚                 â”‚    â”‚   Node å¯åŠ¨     â”‚    â”‚   Nodes å¯åŠ¨    â”‚    â”‚   åŠ¨æ€åŠ è½½      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **èµ„æºä¾èµ–å…³ç³»**

```
èµ„æºä¾èµ–å…³ç³»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Hardware      â”‚    â”‚   Resource      â”‚    â”‚   Controller    â”‚
â”‚   Components    â”‚    â”‚   Manager       â”‚    â”‚   Nodes         â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æä¾›ç¡¬ä»¶    â”‚â”‚    â”‚  â”‚ ç®¡ç†ç¡¬ä»¶    â”‚â”‚    â”‚  â”‚ ä½¿ç”¨ç¡¬ä»¶    â”‚â”‚
â”‚  â”‚ æ¥å£        â”‚â”‚    â”‚  â”‚ æ¥å£        â”‚â”‚    â”‚  â”‚ æ¥å£        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚  State/Command        â”‚  Interface            â”‚  Loaned
         â”‚  Interfaces           â”‚  Registry             â”‚  Interfaces
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   joint1/       â”‚    â”‚   Interface     â”‚    â”‚   claim_        â”‚
â”‚   position      â”‚    â”‚   Management    â”‚    â”‚   & Thread      â”‚
â”‚   joint1/       â”‚    â”‚   & Thread      â”‚    â”‚   set_value()   â”‚
â”‚   velocity      â”‚    â”‚   Safety        â”‚    â”‚   get_value()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ èŠ‚ç‚¹ç®¡ç†ç­–ç•¥

### 1. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**

```cpp
// æ§åˆ¶å™¨ç”Ÿå‘½å‘¨æœŸ
enum class ControllerState {
    UNCONFIGURED,  // æœªé…ç½®
    INACTIVE,      // éæ´»è·ƒ
    ACTIVE,        // æ´»è·ƒ
    FINALIZED      // å·²ç»ˆæ­¢
};

// ç¡¬ä»¶ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
enum class HardwareState {
    UNCONFIGURED,  // æœªé…ç½®
    INACTIVE,      // éæ´»è·ƒ
    ACTIVE,        // æ´»è·ƒ
    FINALIZED      // å·²ç»ˆæ­¢
};
```

### 2. **åŠ¨æ€åŠ è½½æœºåˆ¶**

```cpp
// æ’ä»¶åŠ è½½å™¨
std::shared_ptr<pluginlib::ClassLoader<controller_interface::ControllerInterface>> loader_;
std::shared_ptr<pluginlib::ClassLoader<controller_interface::ChainableControllerInterface>> chainable_loader_;

// åŠ¨æ€åŠ è½½æ§åˆ¶å™¨
auto controller = loader_->createUniqueInstance(controller_type);
```

### 3. **é”™è¯¯å¤„ç†å’Œæ¢å¤**

```cpp
// æ§åˆ¶å™¨é”™è¯¯å¤„ç†
try {
    controller->update(time, period);
} catch (const std::exception& e) {
    RCLCPP_ERROR(logger, "Controller update failed: %s", e.what());
    // è§¦å‘fallbackç­–ç•¥
    activate_fallback_controllers();
}
```

## ğŸ“Š èŠ‚ç‚¹å…³ç³»æ€»ç»“

### **æ¶æ„ç‰¹ç‚¹**

1. **ç»Ÿä¸€æ‰§è¡Œå™¨**: æ‰€æœ‰èŠ‚ç‚¹å…±äº«åŒä¸€ä¸ªMultiThreadedExecutor
2. **åˆ†å±‚ç®¡ç†**: Controller Managerä½œä¸ºæ ¸å¿ƒç®¡ç†èŠ‚ç‚¹
3. **åŠ¨æ€åŠ è½½**: æ§åˆ¶å™¨å’Œç¡¬ä»¶ç»„ä»¶èŠ‚ç‚¹æ”¯æŒåŠ¨æ€åŠ è½½/å¸è½½
4. **å®æ—¶æ€§èƒ½**: ç‹¬ç«‹çš„å®æ—¶çº¿ç¨‹æ‰§è¡Œæ§åˆ¶å¾ªç¯
5. **æœåŠ¡å¯¼å‘**: é€šè¿‡ROS2æœåŠ¡è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡

### **é€šä¿¡æ¨¡å¼**

1. **æœåŠ¡é€šä¿¡**: ç”¨äºæ§åˆ¶å’Œç®¡ç†æ“ä½œ
2. **è¯é¢˜é€šä¿¡**: ç”¨äºçŠ¶æ€ç›‘æ§å’Œæ•°æ®æµ
3. **å‚æ•°é€šä¿¡**: ç”¨äºé…ç½®ç®¡ç†
4. **ç›´æ¥è°ƒç”¨**: ç”¨äºå®æ—¶æ§åˆ¶å¾ªç¯

### **è®¾è®¡ä¼˜åŠ¿**

1. **æ¨¡å—åŒ–**: å„èŠ‚ç‚¹èŒè´£æ˜ç¡®ï¼Œä¾¿äºå¼€å‘å’Œç»´æŠ¤
2. **å¯æ‰©å±•**: æ”¯æŒåŠ¨æ€åŠ è½½æ–°çš„æ§åˆ¶å™¨å’Œç¡¬ä»¶ç»„ä»¶
3. **å®æ—¶æ€§**: ç‹¬ç«‹çš„å®æ—¶çº¿ç¨‹ç¡®ä¿æ§åˆ¶æ€§èƒ½
4. **å¯é æ€§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
5. **æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„æ¥å£å’Œé€šä¿¡æ¨¡å¼

è¿™ç§èŠ‚ç‚¹å…³ç³»è®¾è®¡ä½¿å¾—ROS2 Controlèƒ½å¤Ÿé«˜æ•ˆåœ°ç®¡ç†å¤æ‚çš„æœºå™¨äººæ§åˆ¶ç³»ç»Ÿï¼ŒåŒæ—¶ä¿æŒè‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ 